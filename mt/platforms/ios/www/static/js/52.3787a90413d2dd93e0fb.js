webpackJsonp([52],{310:function(t,e,a){a(613);var i=a(0)(a(467),a(722),"data-v-32b6f242",null);t.exports=i.exports},347:function(t,e,a){"use strict";function i(t){return a.i(n.a)({url:"/api/workflow/process",method:"post",data:t})}function s(t){return a.i(n.a)({url:"/api/workflow/show_opinion",method:"post",data:t})}e.a=i,e.b=s;var n=a(7)},358:function(t,e,a){"use strict";function i(t){return a.i(r.a)({url:"/api/iv/store_room/search_mat",method:"post",data:t})}function s(t){return a.i(r.a)({url:"/api/iv/scrap_mat_bill/modify",method:"post",data:t})}function n(t){return a.i(r.a)({url:"/api/iv/scrap_mat_bill/list",method:"post",data:t})}function o(t){return a.i(r.a)({url:"/api/iv/scrap_mat_bill/detail",method:"post",data:t})}function c(t){return a.i(r.a)({url:"/api/iv/scrap_mat_bill/scrap",method:"post",data:t})}e.d=i,e.c=s,e.e=n,e.b=o,e.a=c;var r=a(7)},467:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(358),s=a(347),n=a(20),o=a.n(n),c=a(48),r=a(4);e.default={name:"scrapDetail",components:{SwipeItem:o.a},data:function(){return{step:"",scrap_no:"",is_scraped:"",action:"",depsList:[],dep_name:"请选择",dep_id:"",mat_no:"",bill_id:"",request_date:"",searchMatLit:[],store_mat_list:[],selectInfo:{switch:!1,selectType:"",title:"请选择部门",list:[]}}},activated:function(){},methods:{scrapSubmit:function(){var t={scrap_id:this.scrap_id};$dialog.confirm({theme:"ios",title:"确定要执行报废吗？",cancelText:"取消",okText:"确定"}).then(function(e){e&&a.i(i.a)(t).then(function(t){t.scrap_info&&($toast.show("执行报废成功"),$router.go(-1))}).catch(function(t){$toast.show(t.description)})})},CancelEdit:function(){this.scrapDetail(),this.action="check"},scrapDetail:function(){var t=this,e={query:{scrap_id:this.scrap_id}};a.i(i.b)(e).then(function(e){t.scrap_no=e.scrap_mat_info.scrap_no,t.dep_name=e.scrap_mat_info.dep_name,t.request_date=e.scrap_mat_info.request_date,t.store_mat_list=e.scrap_mat_info.scrap_detail_list,t.step=e.scrap_mat_info.approve_step,t.is_scraped=e.scrap_mat_info.is_scraped}).catch(function(t){$toast.show(t.description)})},submitApprove:function(){var t={approve_flag:"1",approve_man_id:"",approve_man_name:"",approve_step:"step10",approve_sugg:"",bill_id:this.bill_id,bill_type:"10"};a.i(s.a)(t).then(function(t){$router.go(-1),$toast.show("报废单信息提交成功")}).catch(function(t){$toast.show(t.description)})},submit:function(){var t=this;if("请选择"===this.dep_name)return void $toast.show("请选择申请部门");var e=0;if(!(this.store_mat_list.length>0))return void $toast.show("报废物料不能为空");if(this.store_mat_list.forEach(function(t,a){if(""===t.remark)return void(e=1)}),0==e){var s={scrap_mat_info:{approve_step:"",approve_sugg:"",dep_id:this.dep_id,dep_name:this.dep_name,request_date:a.i(c.a)(),scrap_detail_list:this.store_mat_list,scrap_id:"",scrap_no:""}};a.i(i.c)(s).then(function(e){"new"===t.action?(t.bill_id=e.scrap_id,t.submitApprove()):(t.CancelEdit(),$toast.show("报废单信息编辑成功"))}).catch(function(t){$toast.show(t.description)})}else $toast.show("请填写报废说明")},onSelect:function(t){var e=this;switch(this.selectInfo.selectType=t,this.selectInfo.list=[],this.mat_no="",t){case"add":this.selectInfo.switch=!0;break;case"depName":this.depsList.forEach(function(t,a){e.selectInfo.list.push(t.dep_name)}),this.selectInfo.switch=!0}},Delete:function(t){this.store_mat_list.splice(t,1)},onCheck:function(t,e){switch(this.selectInfo.selectType){case"add":var a=0;if(this.store_mat_list.forEach(function(e,i){if(e.mat_no==t)return void(a=1)}),0===a){var i=this.searchMatLit[e];this.$set(i,"deal_flag",""),this.$set(i,"detail_id",""),this.$set(i,"quantity",1),this.$set(i,"remark",""),this.store_mat_list.push(i)}else $toast.show("该物料已被添加到列表中");break;case"depNmae":this.dep_name=this.depsList[e].dep_name,this.dep_id=this.depsList[e].dep_id}this.selectInfo.switch=!1},searchMat:function(){var t=this;if(this.mat_no.length>0){var e={query:{mat_desc:"",mat_id:"",mat_model:"",mat_no:this.mat_no}};a.i(i.d)(e).then(function(e){t.searchMatLit=e.store_mat_list,t.searchMatLit.length>0&&(t.selectInfo.list=[],t.searchMatLit.forEach(function(e,a){t.selectInfo.list.push(e.mat_no)}))}).catch(function(t){$toast.show(t.description)})}},onChange:function(t,e,a){var i=this;"check"!==this.action&&("-1"===e?Number(t.quantity)>1?t.quantity=Number(t.quantity)-1:$dialog.confirm({theme:"ios",title:"确定要删除吗？",cancelText:"取消",okText:"确定"}).then(function(t){t&&i.Delete(a)}):"1"===e?t.quantity<t.stock_qty?t.quantity=Number(t.quantity)+1:$toast.show("数量已达到库存数"):t.quantity<1?$dialog.confirm({theme:"ios",title:"确定要删除吗？",cancelText:"取消",okText:"确定"}).then(function(e){e?i.Delete(a):t.quantity=1}):t.quantity>t.stock_qty&&(t.quantity=t.stock_qty))}},computed:a.i(r.a)(["userinfo","chosenCompany"]),mounted:function(){this.action=this.$route.params.action,this.scrap_id=this.$route.params.scrap_id,"new"===this.action?this.chosenCompany.deps.length>1?this.depsList=this.chosenCompany.deps:(this.depsList=this.chosenCompany.deps,this.dep_name=this.chosenCompany.deps[0].dep_name,this.dep_id=this.chosenCompany.deps[0].dep_id):"check"===this.action&&this.scrapDetail()}}},512:function(t,e,a){e=t.exports=a(220)(),e.push([t.i,"\n.singleDetail > .new[data-v-32b6f242] {\n  padding-top: 98px !important;\n}\n.singleDetail > .new .mateListTop[data-v-32b6f242] {\n    top: 98px !important;\n}\n.singleDetail > .action[data-v-32b6f242], .singleDetail > .check[data-v-32b6f242] {\n  padding-top: 196px !important;\n}\n.singleDetail > .action .mateListTop[data-v-32b6f242], .singleDetail > .check .mateListTop[data-v-32b6f242] {\n    top: 196px !important;\n}\n.singleDetail .list[data-v-32b6f242] {\n  padding-top: 30px;\n}\n.item span[data-v-32b6f242] {\n  overflow: visible;\n}\ninput[data-v-32b6f242]:disabled {\n  background: #fff;\n}\n","",{version:3,sources:["E:/weibosi/webs-mt/mt/www_dev/src/views/storage/scrap/detail.vue"],names:[],mappings:";AACA;EACE,6BAA6B;CAC9B;AACD;IACI,qBAAqB;CACxB;AACD;EACE,8BAA8B;CAC/B;AACD;IACI,sBAAsB;CACzB;AACD;EACE,kBAAkB;CACnB;AACD;EACE,kBAAkB;CACnB;AACD;EACE,iBAAiB;CAClB",file:"detail.vue",sourcesContent:["\n.singleDetail > .new[data-v-32b6f242] {\n  padding-top: 98px !important;\n}\n.singleDetail > .new .mateListTop[data-v-32b6f242] {\n    top: 98px !important;\n}\n.singleDetail > .action[data-v-32b6f242], .singleDetail > .check[data-v-32b6f242] {\n  padding-top: 196px !important;\n}\n.singleDetail > .action .mateListTop[data-v-32b6f242], .singleDetail > .check .mateListTop[data-v-32b6f242] {\n    top: 196px !important;\n}\n.singleDetail .list[data-v-32b6f242] {\n  padding-top: 30px;\n}\n.item span[data-v-32b6f242] {\n  overflow: visible;\n}\ninput[data-v-32b6f242]:disabled {\n  background: #fff;\n}\n"],sourceRoot:""}])},613:function(t,e,a){var i=a(512);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a(221)("615b17c5",i,!0)},722:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"nav",rawName:"v-nav",value:{hideNavbar:!0},expression:"{hideNavbar:true}"}],staticClass:"mw-page page storage"},[a("div",{staticClass:"mw-page-header"},[a("i",{staticClass:"left icon ion-ios-arrow-back",on:{click:function(e){t.$router.go(-1)}}}),t._v(" "),"new"===t.action?a("span",[t._v("新建物料报废单")]):a("span",[t._v("物料报废单详情")]),t._v(" "),a("i",{directives:[{name:"show",rawName:"v-show",value:"new"===t.action,expression:"action==='new'"}],staticClass:"right iconfont icon-saoyisao"}),t._v(" "),a("i",{directives:[{name:"show",rawName:"v-show",value:"step0"===t.step,expression:"step==='step0'"}],staticClass:"right "}),t._v(" "),a("i",{directives:[{name:"show",rawName:"v-show",value:"check"===t.action&&"step0"!==t.step,expression:"action==='check'&&step!=='step0'"}],staticClass:"right ",on:{click:function(e){t.action="action"}}},[t._v("编辑")]),t._v(" "),a("i",{directives:[{name:"show",rawName:"v-show",value:"action"===t.action,expression:"action==='action'"}],staticClass:"right ",on:{click:function(e){t.CancelEdit()}}},[t._v("取消")])]),t._v(" "),a("div",{staticClass:"mw-page-content singleDetail",class:t.action},[a("div",{staticClass:"header"},[a("item",{directives:[{name:"show",rawName:"v-show",value:"new"!==t.action,expression:"action!=='new'"}]},[t._v("\n          物料报废单号:\n          "),a("span",{staticClass:"item-note"},[t._v(t._s(t.scrap_no))])]),t._v(" "),a("item",[t._v("\n          申请人:\n          "),a("span",{staticClass:"item-note"},[t._v(t._s(t.userinfo.username))])]),t._v(" "),a("item",[t._v("\n          申请部门:\n          "),1===t.depsList.length||"new"!==t.action?a("span",{staticClass:"item-note"},[t._v(t._s(t.dep_name))]):a("span",{staticClass:"item-note",staticStyle:{overflow:"visible"},on:{click:function(e){t.onSelect("depName")}}},[t._v("\n            "+t._s(t.dep_name)),a("i",{staticClass:"icon ion-ios-arrow-right",staticStyle:{color:"#DDD",float:"right","font-size":"20px","margin-top":"-4px"}})])]),t._v(" "),a("item",{directives:[{name:"show",rawName:"v-show",value:"new"!==t.action,expression:"action!=='new'"}]},[t._v("\n          申请日期:\n          "),a("span",{staticClass:"item-note"},[t._v(t._s(t.request_date))])])],1),t._v(" "),a("div",{staticClass:"mateList",class:t.action},[a("div",{staticClass:"mateListTop"},[a("span",[t._v("报废物料列表")]),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:"check"!==t.action,expression:"action!=='check'"}],staticClass:"right",on:{click:function(e){t.onSelect("add")}}},[t._v("添加")])]),t._v(" "),a("div",{staticClass:"list"},t._l(t.store_mat_list,function(e,i){return a("div",{staticClass:"item"},[a("div",{staticClass:"itemInfo"},[a("div",{staticClass:"numberBox"},[a("span",{on:{click:function(a){t.onChange(e,"1")}}},[t._v("+")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.quantity,expression:"item.quantity"}],attrs:{disabled:"check"===t.action,type:"number"},domProps:{value:e.quantity},on:{change:function(a){t.onChange(e)},input:function(a){a.target.composing||t.$set(e,"quantity",a.target.value)}}}),t._v(" "),a("span",{on:{click:function(a){t.onChange(e,"-1",i)}}},[t._v("-")])]),t._v(" "),a("h3",[t._v("物料编码: "),a("span",[t._v(t._s(e.mat_no))])]),t._v(" "),a("p",[t._v("物料名称: "),a("span",[t._v(t._s(e.mat_desc))])]),t._v(" "),a("p",[t._v("规格型号: "),a("span",[t._v(t._s(e.mat_model))])]),t._v(" "),a("p",[t._v("物料类型: "),a("span",[t._v(t._s(e.mat_type_name))])]),t._v(" "),"new"===t.action?a("p",[t._v("报废原因: "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"item.remark"}],attrs:{type:"text",placeholder:"请输入报废原因"},domProps:{value:e.remark},on:{input:function(a){a.target.composing||t.$set(e,"remark",a.target.value)}}})]):a("p",[t._v("报废原因: "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.reason,expression:"item.reason"}],attrs:{disabled:"",type:"text",placeholder:"请输入报废原因"},domProps:{value:e.reason},on:{input:function(a){a.target.composing||t.$set(e,"reason",a.target.value)}}})])])])}))])]),t._v(" "),a("div",{staticClass:"select-box",class:t.selectInfo.switch?"active":""},[a("div",{staticClass:"select-click",on:{click:function(e){t.selectInfo.switch=!1}}}),t._v(" "),a("div",{staticClass:"select-main"},[a("div",{staticClass:"main-header"},[a("input",{directives:[{name:"show",rawName:"v-show",value:"add"===t.selectInfo.selectType,expression:"selectInfo.selectType==='add'"},{name:"model",rawName:"v-model",value:t.mat_no,expression:"mat_no"}],staticStyle:{"margin-top":"10px"},attrs:{type:"text",placeholder:"请输物料编号"},domProps:{value:t.mat_no},on:{keyup:t.searchMat,input:function(e){e.target.composing||(t.mat_no=e.target.value)}}}),t._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:"add"!==t.selectInfo.selectType,expression:"selectInfo.selectType!=='add'"}]},[t._v(t._s(t.selectInfo.title))])]),t._v(" "),a("div",{staticClass:"main-list",staticStyle:{height:"100%"}},t._l(t.selectInfo.list,function(e,i){return a("p",{on:{click:function(a){t.onCheck(e,i)}}},[t._v(t._s(e))])}))])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.store_mat_list.length>0&&"new"===t.action,expression:"store_mat_list.length>0&&action==='new'"}],staticClass:"mw-page-footer"},[a("div",{staticClass:"btns"},[a("div",{staticClass:"btn",on:{click:function(e){t.submit()}}},[t._v("\n        提交审批\n      ")])])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"action"===t.action,expression:"action==='action'"}],staticClass:"mw-page-footer"},[a("div",{staticClass:"btns"},[a("div",{staticClass:"btn",on:{click:function(e){t.submit()}}},[t._v("\n        保存\n      ")])])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"step0"===t.step&&"check"===t.action&&0==t.is_scraped,expression:"step==='step0'&&action==='check'&&is_scraped==0"}],staticClass:"mw-page-footer"},[a("div",{staticClass:"btns"},[a("div",{staticClass:"btn",on:{click:function(e){t.scrapSubmit()}}},[t._v("\n        执行报废\n      ")])])])])},staticRenderFns:[]}}});
//# sourceMappingURL=52.3787a90413d2dd93e0fb.js.map