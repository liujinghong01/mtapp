webpackJsonp([81],{281:function(t,e,a){a(710);var s=a(0)(a(479),a(853),"data-v-03211aa2",null);t.exports=s.exports},395:function(t,e,a){"use strict";function s(t){return a.i(v.a)({url:"/api/bom/list",method:"post",data:t})}function i(t){return a.i(v.a)({url:"api/bom_node/list",method:"post",data:t})}function o(t){return a.i(v.a)({url:"/api/bom_node/update",method:"post",data:t})}function n(t){return a.i(v.a)({url:"/api/cascade_type/list",method:"post",data:t})}function c(t){return a.i(v.a)({url:"/api/mat_name/list",method:"post",data:t})}function p(t){return a.i(v.a)({url:"/api/mat_name_spec/list",method:"post",data:t})}function r(t){return a.i(v.a)({url:"/api/cascade_mat/list",method:"post",data:t})}function d(t){return a.i(v.a)({url:"/api/rawnature/list",method:"post",data:t})}function l(t){return a.i(v.a)({url:"/api/rawnature/price",method:"post",data:t})}function _(t){return a.i(v.a)({url:"/api/bom_node/info",method:"post",data:t})}function u(t){return a.i(v.a)({url:"/api/bom_node/delete",method:"post",data:t})}e.k=s,e.i=i,e.h=o,e.a=n,e.b=c,e.c=p,e.d=r,e.e=d,e.g=l,e.f=_,e.j=u;var v=a(10)},396:function(t,e,a){"use strict";function s(t){return a.i(o.a)({url:"/api/workflow/process",method:"post",data:t})}function i(t){return a.i(o.a)({url:"/api/workflow/show_opinion",method:"post",data:t})}e.a=s,e.b=i;var o=a(10)},479:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a(14),i=a.n(s),o=a(20),n=a.n(o),c=a(396),p=a(395),r=a(82),d=a.n(r),l=a(5);e.default={name:"bomNodes",components:{MwPrompt:d.a,SwipeItem:n.a},data:function(){return{action:"",swipeX:0,tabs:["半成品","标准件","电极"],tabIndex:0,node_id:"",bom_id:"",app_flag:"",showApprove:!1,approve:{suggestion:""},list:[{bom_node_list:[]},{bom_node_list:[]},{bom_node_list:[]}]}},computed:i()({},a.i(l.a)(["userinfo"])),methods:{onInfinite:function(t){t()},submit:function(){var t=this,e={bill_id:this.bom_id,bill_type:"20",approve_flag:"1",approve_step:"step10"};a.i(c.a)(e).then(function(e){$toast.show("提交成功"),t.$router.go(-1)}).catch(function(t){$toast.show(t.description)})},onRefresh:function(){},getData:function(){var t=this,e=this,s={query:{bom_id:e.bom_id,node_id:e.node_id,mat_type:e.tabs[e.tabIndex]}};a.i(p.i)(s).then(function(a){t.list[e.tabIndex].bom_node_list=a.bom_node_list}).catch(function(t){$toast.show(t.description)})},bomNodeDelete:function(t,e){var s=this;event.currentTarget.parentNode.classList.remove("active"),$dialog.confirm({theme:"ios",title:"确定要删除吗？",cancelText:"取消",okText:"确定"}).then(function(i){if(i){var o={node_id:t.node_id};a.i(p.j)(o).then(function(t){s.list[s.tabIndex].bom_node_list.splice(e,1),$toast.show("删除成功")}).catch(function(t){$toast.show(t.description)})}})},onMenuClick:function(){},touchstart:function(){this.swipeX=event.targetTouches[0].clientX},touchend:function(){var t=event.changedTouches[0].clientX+30;if("step30"!==this.app_flag&&2!==this.tabIndex&&t<this.swipeX){for(var e=event.currentTarget.parentNode.children,a=0;a<e.length;a++)e[a].classList.contains("active")&&e[a].classList.remove("active");event.currentTarget.classList.add("active")}},offSwipe:function(){event.currentTarget.parentNode.classList.remove("active")},onTabClick:function(t){t!==this.tabIndex&&(this.tabIndex=t,this.getData())},onItemClick:function(t){this.$router.forward("/mats/bom/nodeDetail/check/"+t.node_id+"/"+this.tabIndex+"/"+this.app_flag)},goNodesList:function(t){this.$router.forward({path:"/mats/bom/nodes/childNode",query:{type:t.mat_type,bom_id:this.bom_id,node_id:t.node_id,app_flag:this.app_flag}})},electrode:function(t){"0"===t.is_purchase?"step30"!==this.app_flag?this.$router.forward("/mats/bom/nodeDetail/new/"+t.node_id+"/2/"+this.app_flag):$toast.show("该半成品下没有电极"):this.$router.forward({path:"/mats/bom/nodes/childNode",query:{bom_id:this.bom_id,node_id:t.node_id,app_flag:this.app_flag,type:"电极"}})},delItem:function(t){console.log(t)},approveProcess:function(t){console.log("approveProcess"),t="ok"===t?1:2;var e={approve_sugg:this.approve.suggestion,bill_id:this.bom_id,bill_type:20,approve_step:this.app_flag,approve_man_id:this.userinfo.uid,approve_man_name:this.userinfo.username,approve_flag:t};a.i(c.a)(e).then(function(t){history.go(-1)}).catch(function(t){$toast.show(t.description)})}},activated:function(){this.getData()},mounted:function(){this.node_id=this.$route.params.node_id,this.bom_id=this.$route.params.bom_id,this.action=this.$route.params.action,this.app_flag=this.$route.params.app_flag}}},571:function(t,e,a){e=t.exports=a(225)(),e.push([t.i,"","",{version:3,sources:[],names:[],mappings:"",file:"nodes.vue",sourceRoot:""}])},710:function(t,e,a){var s=a(571);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);a(226)("9d7e99da",s,!0)},853:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"nav",rawName:"v-nav",value:{hideNavbar:!0},expression:"{hideNavbar:true}"}],staticClass:"mw-page page mats"},[a("div",{staticClass:"mw-page-header"},[a("i",{staticClass:"left icon ion-ios-arrow-back",on:{click:function(e){t.$router.go(-1)}}}),t._v(" "),"step30"===t.$route.params.app_flag?a("span",[t._v("BOM详情")]):a("span",[t._v("BOM编辑")]),t._v(" "),a("i",{staticClass:"right"})]),t._v(" "),a("div",{staticClass:"mw-page-content"},[a("div",{staticClass:"mw-page-content has-tab"},[a("div",{staticStyle:{height:"60px"}},[a("tabs",{attrs:{"tab-items":t.tabs,"tab-index":t.tabIndex,"on-tab-click":t.onTabClick}})],1)]),t._v(" "),a("div",{staticStyle:{flex:"1"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:0===t.tabIndex,expression:"tabIndex===0"}],staticClass:"content"},t._l(t.list[t.tabIndex].bom_node_list,function(e,s){return a("div",{staticClass:"bom-swipe-item",on:{touchstart:function(e){t.touchstart(e)},touchend:function(e){t.touchend(e)}}},[a("div",{staticClass:"swipe-content"},[a("div",{on:{click:function(a){t.onItemClick(e)}}},[a("h3",{staticStyle:{"text-overflow":"ellipsis",display:"block","white-space":"nowrap"}},[t._v("物料编号："),a("span",[t._v(t._s(e.mat_no))])]),t._v(" "),a("h3",[t._v("物料名称："),a("span",[t._v(t._s(e.mat_name))])]),t._v(" "),a("p",[a("span",[t._v("规格尺寸("+t._s(e.spec)+")")]),t._v(" "),a("span",[t._v("材质("+t._s(e.rawnature_name)+")")])]),t._v(" "),a("p",[a("span",[t._v("数量("+t._s(e.total_qty)+")")])])]),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:"1"===e.is_purchase,expression:"item.is_purchase==='1'"}],staticClass:"icon ion-ios-arrow-right",on:{click:function(a){t.goNodesList(e)}}})]),t._v(" "),a("div",{staticClass:"swipe-click",on:{click:function(e){t.offSwipe("点击事件")}}}),t._v(" "),a("div",{staticClass:"swipe-side",on:{click:function(a){t.bomNodeDelete(e,s)}}},[a("p",[t._v("删除")])])])})),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.tabIndex,expression:"tabIndex===1"}],staticClass:"content"},t._l(t.list[t.tabIndex].bom_node_list,function(e,s){return a("div",{staticClass:"bom-swipe-item",on:{touchstart:function(e){t.touchstart(e)},touchend:function(e){t.touchend(e)}}},[a("div",{staticClass:"swipe-content",on:{click:function(a){t.onItemClick(e)}}},[a("div",[a("h3",{staticStyle:{"text-overflow":"ellipsis",display:"block","white-space":"nowrap"}},[t._v("物料编号："),a("span",[t._v(t._s(e.mat_no))])]),t._v(" "),a("h3",[t._v("物料名称："),a("span",[t._v(t._s(e.mat_type))])]),t._v(" "),a("p",[a("span",[t._v("规格尺寸("+t._s(e.spec)+")")]),t._v(" "),a("span",[t._v("材质("+t._s(e.rawnature_name)+")")]),t._v(" "),a("span",[t._v("数量("+t._s(e.total_qty)+")")])])])]),t._v(" "),a("div",{staticClass:"swipe-click",on:{click:t.offSwipe}}),t._v(" "),a("div",{staticClass:"swipe-side",on:{click:function(a){t.bomNodeDelete(e,s)}}},[a("p",[t._v("删除")])])])})),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2===t.tabIndex,expression:"tabIndex===2"}],staticClass:"content"},t._l(t.list[t.tabIndex].bom_node_list,function(e,s){return a("div",{directives:[{name:"show",rawName:"v-show",value:!(("step30"===t.app_flag||"step0"===t.app_flag)&&e.is_purchase+""=="0"),expression:"!((app_flag==='step30'||app_flag==='step0')&&item.is_purchase+''==='0')"}],staticClass:"bom-swipe-item",on:{touchstart:function(e){t.touchstart(e)},touchend:function(e){t.touchend(e)}}},[a("div",{staticClass:"swipe-content",on:{click:function(a){t.electrode(e)}}},[a("div",[a("h3",{staticStyle:{"text-overflow":"ellipsis",display:"block","white-space":"nowrap"}},[t._v("物料编号："),a("span",[t._v(t._s(e.mat_no))])]),t._v(" "),a("h3",[t._v("物料名称："),a("span",[t._v(t._s(e.mat_type))])]),t._v(" "),a("p",[a("span",[t._v("规格尺寸("+t._s(e.spec)+")")]),t._v(" "),a("span",[t._v("材质("+t._s(e.rawnature_name)+")")])]),t._v(" "),a("p",[a("span",[t._v("数量("+t._s(e.total_qty)+")")])])]),t._v(" "),"1"===e.is_purchase?a("span",{}):a("span",{directives:[{name:"show",rawName:"v-show",value:"check"===t.action&&"step30"!==t.app_flag&&"step0"!==t.app_flag,expression:"action==='check'&&app_flag!=='step30'&&app_flag!=='step0'"}],staticClass:"right"},[t._v("添加电极")])]),t._v(" "),a("div",{staticClass:"swipe-click",on:{click:t.offSwipe}}),t._v(" "),a("div",{staticClass:"swipe-side",on:{click:function(a){t.bomNodeDelete(e,s)}}},[t._v("删除")])])}))])]),t._v(" "),a("mw-prompt",{attrs:{show:t.showApprove,okFunction:t.approveProcess,title:"核算单审批",placeholder:"请输入审批意见",okText:"同意",cancelText:"不同意",cancelFunction:t.approveProcess,promptType:"textarea"},on:{hidePop:function(e){t.showApprove=!1}},model:{value:t.approve.suggestion,callback:function(e){t.$set(t.approve,"suggestion",e)},expression:"approve.suggestion"}}),t._v(" "),a("div",{staticClass:"mw-page-footer"},["step30"!==t.app_flag&&"step0"!==t.app_flag?a("div",{staticClass:"btns"},[a("div",{directives:[{name:"show",rawName:"v-show",value:2!==t.tabIndex,expression:"tabIndex!==2"}],staticClass:"btn",on:{click:function(e){t.$router.forward("/mats/bom/nodeDetail/new/"+t.node_id+"/"+t.tabIndex+"/"+t.app_flag)}}},[t._v("\n                添加\n            ")]),t._v(" "),a("div",{staticClass:"btn",on:{click:t.submit}},[t._v("\n                提交审批\n            ")])]):"approve"===t.$route.params.action?a("div",{staticClass:"btns"},[a("div",{staticClass:"btn",on:{click:function(e){t.showApprove=!0}}},[t._v("\n          审批\n        ")])]):t._e()])],1)},staticRenderFns:[]}}});
//# sourceMappingURL=81.ed1ee8692c2f2b46ed77.js.map