webpackJsonp([91],{351:function(t,e,s){s(747);var i=s(0)(s(550),s(894),"data-v-369a6fe4",null);t.exports=i.exports},415:function(t,e,s){"use strict";function i(t){return s.i(n.a)({url:"/api/iv/storehouse/list",method:"post",data:t})}function o(t){return s.i(n.a)({url:"/api/iv/storehouse/detail",method:"post",data:t})}function a(t){return s.i(n.a)({url:"/api/iv/store_mat/direct_change",method:"post",data:t})}e.c=i,e.b=o,e.a=a;var n=s(10)},550:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(6),o=s.n(i),a=s(415),n=s(1);e.default={name:"newManagement",data:function(){return{type:"请选择",storehouse_list:[],storeRoom_list:[],storeRoomIndex:"",action:"",requestData:{change_detail_list:[],change_id:"",change_no:"",change_type:"",create_time:"",creator_id:"",in_store_house_id:"",in_store_house_name:"请选择仓库名称",out_store_house_id:"",out_store_house_name:"请选择仓库名称",remark:"",total_price:"",total_qty:"",total_weight:""},selectInfo:{switch:!1,selectType:"",title:"请选择类型",list:[]},typeList:["物料调拨","直接入库","直接出库"],numbList:[]}},computed:{numberList:function(){},totalCount:function(){var t=0,e=0;return this.requestData.change_detail_list.filter(function(s){e+=Number(s.quantity)*Number(s.total_price),t+=Number(s.quantity)}),this.requestData.total_price=e,this.requestData.total_qty=t,"总数量:"+t}},activated:function(){var t=JSON.parse(n.a.get("mats"));t?(this.requestData.change_detail_list=t,console.log("本地储存读取成功"+t),n.a.remove("mats")):console.log("本地储存为空")},methods:{submit:function(){if(this.requestData.change_detail_list.length<1)return void $toast.show("请添加物料");if(""===this.requestData.in_store_house_id){if(""===this.requestData.out_store_house_id)return void $toast.show("请选择仓库")}else{var t=!0;if(this.requestData.change_detail_list.forEach(function(e,s){void 0!==e.in_store_room_id&&""!==e.in_store_room_id||(t=!1)}),!t)return void $toast.show("请选择物料库位")}var e={change_info:this.requestData};s.i(a.a)(e).then(function(t){}).catch(function(t){$toast.show(t.description)})},storeRoomList:function(){var t=this,e={query:{store_house_id:this.requestData.in_store_house_id}};s.i(a.b)(e).then(function(e){t.storeRoom_list=e.store_house_info.store_room_list}).catch(function(t){$toast.show(t.description)})},onChange:function(t,e,s){var i=this;if("new"===this.action){"-1"===e?t.quantity=Number(t.quantity)-1:"1"===e&&(""===this.requestData.out_store_house_id?t.quantity=Number(t.quantity)+1:t.quantity<t.stock_qty&&(t.quantity=Number(t.quantity)+1));var o=Number(t.quantity);o%1!=0&&(t.quantity=parseInt(o)),t.quantity<=0&&$dialog.confirm({theme:"ios",title:"确定要删除吗？",cancelText:"取消",okText:"确定"}).then(function(e){e?i.requestData.change_detail_list.splice(s,1):t.quantity=1}),o>t.stock_qty&&""!==this.requestData.out_store_house_id&&(t.quantity=t.stock_qty)}},onSelect:function(t,e){var s=this;switch(this.selectInfo.selectType=t,t){case"type":this.selectInfo.list=this.typeList;break;case"houseOut":case"houseIn":this.selectInfo.list=[],this.storehouse_list.forEach(function(t,e){s.selectInfo.list.push(t.store_house_name)});break;case"storeRoom":this.selectInfo.list=[],this.storeRoomIndex=e,this.storeRoom_list.forEach(function(t,e){s.selectInfo.list.push(t.store_room_name)})}this.selectInfo.switch=!0},onCheck:function(t,e){switch(this.selectInfo.selectType){case"type":if(this.type===t)break;this.type=t,this.requestData.change_detail_list=[],this.requestData.out_store_house_name="请选择仓库名称",this.requestData.out_store_house_id="",this.requestData.in_store_house_name="请选择仓库名称",this.requestData.in_store_house_id="";break;case"houseOut":if(this.requestData.out_store_house_name===t)break;this.requestData.out_store_house_name=t,this.requestData.out_store_house_id=this.storehouse_list[e].store_house_id,this.requestData.in_store_house_name="请选择仓库名称",this.requestData.in_store_house_id="";break;case"houseIn":if(this.requestData.in_store_house_name===t)break;this.requestData.in_store_house_name=t,this.requestData.in_store_house_id=this.storehouse_list[e].store_house_id,this.storeRoomList(),this.requestData.change_detail_list.forEach(function(t,e){t.in_store_room_id&&(t.in_store_room_id="",t.in_store_room_name="请选择库位")});break;case"storeRoom":var s=this.storeRoom_list[e],i=this.requestData.change_detail_list;i[this.storeRoomIndex].in_store_room_id?(i[this.storeRoomIndex].in_store_room_id=s.store_room_id,i[this.storeRoomIndex].in_store_room_name=t):(this.$set(i[this.storeRoomIndex],"in_store_room_id",s.store_room_id),this.$set(i[this.storeRoomIndex],"in_store_room_name",t))}this.selectInfo.switch=!1},storehouseList:function(){var t=this,e={};s.i(a.c)(e).then(function(e){t.storehouse_list=e.storehouse_list}).catch(function(t){$toast.show(t.description)})},addMate:function(){if(this.requestData.change_detail_list.length>0){var t=o()(this.requestData.change_detail_list);n.a.set("matList",t),console.log("本地储存成功"+t)}else n.a.set("matList",[]),console.log("本地储存为空");"物料调拨"===this.type&&""!==this.requestData.out_store_house_id&&""!==this.requestData.in_store_house_id?this.$router.forward({path:"/storage/management/matList",query:{house_id:this.requestData.out_store_house_id}}):"直接入库"===this.type&&""!==this.requestData.in_store_house_id?this.$router.forward({path:"/storage/management/matList",query:{house_id:""}}):"直接出库"===this.type&&""!==this.requestData.out_store_house_id?this.$router.forward({path:"/storage/management/matList",query:{house_id:this.requestData.out_store_house_id}}):$toast.show("请先选择仓库信息")}},mounted:function(){this.action=this.$route.params.action,this.storehouseList()}}},608:function(t,e,s){e=t.exports=s(225)(),e.push([t.i,"\n.singleDetail .mateList.active[data-v-369a6fe4] {\n  padding-top: 148px;\n}\n.singleDetail .mateList.active .mateListTop[data-v-369a6fe4] {\n    top: 148px;\n}\n.singleDetail .mateList .mateListTop[data-v-369a6fe4] {\n  top: 98px;\n}\n","",{version:3,sources:["/Users/zxf/code/motooling/mt-app/webs-mtapp/mtApp/mt/www_dev/src/views/storage/management/new.vue"],names:[],mappings:";AACA;EACE,mBAAmB;CACpB;AACD;IACI,WAAW;CACd;AACD;EACE,UAAU;CACX",file:"new.vue",sourcesContent:["\n.singleDetail .mateList.active[data-v-369a6fe4] {\n  padding-top: 148px;\n}\n.singleDetail .mateList.active .mateListTop[data-v-369a6fe4] {\n    top: 148px;\n}\n.singleDetail .mateList .mateListTop[data-v-369a6fe4] {\n  top: 98px;\n}\n"],sourceRoot:""}])},747:function(t,e,s){var i=s(608);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);s(226)("3a8ca4ea",i,!0)},894:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"nav",rawName:"v-nav",value:{hideNavbar:!0},expression:"{hideNavbar:true}"}],staticClass:"mw-page page storage"},[s("div",{staticClass:"mw-page-header"},[s("i",{staticClass:"left icon ion-ios-arrow-back",on:{click:function(e){t.$router.go(-1)}}}),t._v(" "),s("span",[t._v("库存物料管理")]),t._v(" "),s("i",{staticClass:"right iconfont icon-saoyisao"})]),t._v(" "),s("div",{staticClass:"mw-page-content singleDetail"},[s("div",{staticClass:"header"},[s("item",[t._v("\n          类型:\n          "),s("span",{staticClass:"item-note",staticStyle:{overflow:"visible"},on:{click:function(e){t.onSelect("type")}}},[t._v("\n            "+t._s(t.type)),s("i",{staticClass:"icon ion-ios-arrow-right",staticStyle:{color:"#DDD",float:"right","font-size":"20px","margin-top":"-4px"}})])]),t._v(" "),s("item",{directives:[{name:"show",rawName:"v-show",value:"物料调拨"===t.type,expression:"type==='物料调拨'"}]},[t._v("\n          调出仓库:\n          "),s("span",{staticClass:"item-note",staticStyle:{overflow:"visible"},on:{click:function(e){t.onSelect("houseOut")}}},[t._v("\n            "+t._s(t.requestData.out_store_house_name)),s("i",{staticClass:"icon ion-ios-arrow-right",staticStyle:{color:"#DDD",float:"right","font-size":"20px","margin-top":"-4px"}})])]),t._v(" "),s("item",{directives:[{name:"show",rawName:"v-show",value:"物料调拨"===t.type,expression:"type==='物料调拨'"}]},[t._v("\n          调入仓库:\n          "),s("span",{staticClass:"item-note",staticStyle:{overflow:"visible"},on:{click:function(e){t.onSelect("houseIn")}}},[t._v("\n            "+t._s(t.requestData.in_store_house_name)),s("i",{staticClass:"icon ion-ios-arrow-right",staticStyle:{color:"#DDD",float:"right","font-size":"20px","margin-top":"-4px"}})])]),t._v(" "),s("item",{directives:[{name:"show",rawName:"v-show",value:"直接入库"===t.type,expression:"type==='直接入库'"}]},[t._v("\n          仓库:\n          "),s("span",{staticClass:"item-note",staticStyle:{overflow:"visible"},on:{click:function(e){t.onSelect("houseIn")}}},[t._v("\n            "+t._s(t.requestData.in_store_house_name)),s("i",{staticClass:"icon ion-ios-arrow-right",staticStyle:{color:"#DDD",float:"right","font-size":"20px","margin-top":"-4px"}})])]),t._v(" "),s("item",{directives:[{name:"show",rawName:"v-show",value:"直接出库"===t.type,expression:"type==='直接出库'"}]},[t._v("\n          仓库:\n          "),s("span",{staticClass:"item-note",staticStyle:{overflow:"visible"},on:{click:function(e){t.onSelect("houseOut")}}},[t._v("\n            "+t._s(t.requestData.out_store_house_name)),s("i",{staticClass:"icon ion-ios-arrow-right",staticStyle:{color:"#DDD",float:"right","font-size":"20px","margin-top":"-4px"}})])])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"请选择"!==t.type,expression:"type!=='请选择'"}],staticClass:"mateList",class:"物料调拨"===t.type?"active":""},[s("div",{staticClass:"mateListTop"},[s("span",[t._v("报废物料列表")]),t._v(" "),s("span",{staticClass:"right",on:{click:function(e){t.addMate()}}},[t._v("添加")])]),t._v(" "),s("div",{staticClass:"list",staticStyle:{"padding-top":"29px"}},t._l(t.requestData.change_detail_list,function(e,i){return s("div",{staticClass:"item"},[s("div",{staticClass:"itemInfo"},[s("div",{staticClass:"numberBox",staticStyle:{top:"15px",height:"70px"}},[s("span",{on:{click:function(s){t.onChange(e,"1")}}},[t._v("+")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.quantity,expression:"item.quantity"}],attrs:{disabled:"new"!==t.action,type:"number"},domProps:{value:e.quantity},on:{change:function(s){t.onChange(e)},input:function(s){s.target.composing||t.$set(e,"quantity",s.target.value)}}}),t._v(" "),s("span",{on:{click:function(s){t.onChange(e,"-1")}}},[t._v("-")]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:""!==t.requestData.in_store_house_id,expression:"requestData.in_store_house_id!==''"}],staticStyle:{"margin-top":"44px","text-align":"right","padding-right":"10px",color:"#4a90e2"},on:{click:function(e){t.onSelect("storeRoom",i)}}},[t._v("\n                  "+t._s(e.in_store_room_name?e.in_store_room_name:"请选择库位")+"\n                  "),s("i",{staticClass:"icon ion-ios-arrow-right"})])]),t._v(" "),s("h3",[t._v("物料编码: "),s("span",[t._v(t._s(e.mat_no))])]),t._v(" "),s("p",[t._v("物料名称: "),s("span",[t._v(t._s(e.mat_desc))])]),t._v(" "),s("p",[t._v("规格型号: "),s("span",[t._v(t._s(e.mat_model))])]),t._v(" "),s("p",[t._v("物料类型: "),s("span",[t._v(t._s(e.mat_type_name))])])])])}))])]),t._v(" "),s("div",{staticClass:"select-box",class:t.selectInfo.switch?"active":""},[s("div",{staticClass:"select-click",on:{click:function(e){t.selectInfo.switch=!1}}}),t._v(" "),s("div",{staticClass:"select-main"},[s("div",{staticClass:"main-header"},[s("p",[t._v(t._s(t.selectInfo.title))])]),t._v(" "),s("div",{staticClass:"main-list",staticStyle:{height:"100%"}},t._l(t.selectInfo.list,function(e,i){return s("p",{directives:[{name:"show",rawName:"v-show",value:e!==t.requestData.out_store_house_name,expression:"item!==requestData.out_store_house_name"}],on:{click:function(s){t.onCheck(e,i)}}},[t._v(t._s(e))])}))])]),t._v(" "),s("div",{staticClass:"mw-page-footer"},[s("div",{staticClass:"btns"},[s("div",{staticClass:"total",staticStyle:{flex:"0 0 80%"},attrs:{style:"flex: 0 0 80%;"}},[s("div",{staticStyle:{display:"flex"}},[s("span",{staticStyle:{width:"50%","text-align":"center"}},[t._v("物料种类:"+t._s(t.requestData.change_detail_list.length))]),t._v(" "),s("span",{staticStyle:{width:"50%","text-align":"center"}},[t._v(t._s(t.totalCount))])])]),t._v(" "),s("div",{staticClass:"btn",staticStyle:{"background-color":"#416eb6",color:"white",padding:"15px 0"},on:{click:t.submit}},[t._v("\n        提交\n      ")])])])])},staticRenderFns:[]}}});
//# sourceMappingURL=91.1714272e538ddc1d8242.js.map