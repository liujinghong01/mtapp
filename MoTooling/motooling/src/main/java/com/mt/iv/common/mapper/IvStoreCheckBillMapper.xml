<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mt.iv.common.dao.IvStoreCheckBillMapper" >
  <resultMap id="BaseResultMap" type="com.mt.iv.common.model.IvStoreCheckBill" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 28 13:56:09 CST 2017.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="check_bill_no" property="checkBillNo" jdbcType="VARCHAR" />
    <result column="company_id" property="companyId" jdbcType="INTEGER" />
    <result column="company_name" property="companyName" jdbcType="VARCHAR" />
    <result column="store_house_id" property="storeHouseId" jdbcType="INTEGER" />
    <result column="store_house_name" property="storeHouseName" jdbcType="VARCHAR" />
    <result column="mat_type_id" property="matTypeId" jdbcType="BIGINT" />
    <result column="mat_type_name" property="matTypeName" jdbcType="VARCHAR" />
    <result column="check_bill_type" property="checkBillType" jdbcType="CHAR" />
    <result column="base_check_bill_id" property="baseCheckBillId" jdbcType="INTEGER" />
    <result column="check_year" property="checkYear" jdbcType="INTEGER" />
    <result column="voucher_no_from" property="voucherNoFrom" jdbcType="VARCHAR" />
    <result column="voucher_id_from" property="voucherIdFrom" jdbcType="BIGINT" />
    <result column="voucher_no_to" property="voucherNoTo" jdbcType="VARCHAR" />
    <result column="voucher_id_to" property="voucherIdTo" jdbcType="BIGINT" />
    <result column="liquidate_flag" property="liquidateFlag" jdbcType="CHAR" />
    <result column="operator_id" property="operatorId" jdbcType="BIGINT" />
    <result column="creator_id" property="creatorId" jdbcType="BIGINT" />
    <result column="handler_id" property="handlerId" jdbcType="BIGINT" />
    <result column="approve_step" property="approveStep" jdbcType="VARCHAR" />
    <result column="approve_sugg" property="approveSugg" jdbcType="VARCHAR" />
    <result column="created_at" property="createdAt" jdbcType="TIMESTAMP" />
    <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP" />
    <result column="status" property="status" jdbcType="TINYINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 28 13:56:09 CST 2017.
    -->
    id, check_bill_no, company_id, company_name, store_house_id, store_house_name, mat_type_id, 
    mat_type_name, check_bill_type, base_check_bill_id, check_year, voucher_no_from, 
    voucher_id_from, voucher_no_to, voucher_id_to, liquidate_flag, operator_id, creator_id, 
    handler_id, approve_step, approve_sugg, created_at, updated_at, status
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 28 13:56:09 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from iv_store_check_bill
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 28 13:56:09 CST 2017.
    -->
    delete from iv_store_check_bill
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.mt.iv.common.model.IvStoreCheckBill" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 28 13:56:09 CST 2017.
    -->
    insert into iv_store_check_bill (id, check_bill_no, company_id, 
      company_name, store_house_id, store_house_name, 
      mat_type_id, mat_type_name, check_bill_type, 
      base_check_bill_id, check_year, voucher_no_from, 
      voucher_id_from, voucher_no_to, voucher_id_to, 
      liquidate_flag, operator_id, creator_id, 
      handler_id, approve_step, approve_sugg, 
      created_at, updated_at, status
      )
    values (#{id,jdbcType=BIGINT}, #{checkBillNo,jdbcType=VARCHAR}, #{companyId,jdbcType=INTEGER}, 
      #{companyName,jdbcType=VARCHAR}, #{storeHouseId,jdbcType=INTEGER}, #{storeHouseName,jdbcType=VARCHAR}, 
      #{matTypeId,jdbcType=BIGINT}, #{matTypeName,jdbcType=VARCHAR}, #{checkBillType,jdbcType=CHAR}, 
      #{baseCheckBillId,jdbcType=INTEGER}, #{checkYear,jdbcType=INTEGER}, #{voucherNoFrom,jdbcType=VARCHAR}, 
      #{voucherIdFrom,jdbcType=BIGINT}, #{voucherNoTo,jdbcType=VARCHAR}, #{voucherIdTo,jdbcType=BIGINT}, 
      #{liquidateFlag,jdbcType=CHAR}, #{operatorId,jdbcType=BIGINT}, #{creatorId,jdbcType=BIGINT}, 
      #{handlerId,jdbcType=BIGINT}, #{approveStep,jdbcType=VARCHAR}, #{approveSugg,jdbcType=VARCHAR}, 
      #{createdAt,jdbcType=TIMESTAMP}, #{updatedAt,jdbcType=TIMESTAMP}, #{status,jdbcType=TINYINT}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.mt.iv.common.model.IvStoreCheckBill" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 28 13:56:09 CST 2017.
    -->
    insert into iv_store_check_bill
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="checkBillNo != null" >
        check_bill_no,
      </if>
      <if test="companyId != null" >
        company_id,
      </if>
      <if test="companyName != null" >
        company_name,
      </if>
      <if test="storeHouseId != null" >
        store_house_id,
      </if>
      <if test="storeHouseName != null" >
        store_house_name,
      </if>
      <if test="matTypeId != null" >
        mat_type_id,
      </if>
      <if test="matTypeName != null" >
        mat_type_name,
      </if>
      <if test="checkBillType != null" >
        check_bill_type,
      </if>
      <if test="baseCheckBillId != null" >
        base_check_bill_id,
      </if>
      <if test="checkYear != null" >
        check_year,
      </if>
      <if test="voucherNoFrom != null" >
        voucher_no_from,
      </if>
      <if test="voucherIdFrom != null" >
        voucher_id_from,
      </if>
      <if test="voucherNoTo != null" >
        voucher_no_to,
      </if>
      <if test="voucherIdTo != null" >
        voucher_id_to,
      </if>
      <if test="liquidateFlag != null" >
        liquidate_flag,
      </if>
      <if test="operatorId != null" >
        operator_id,
      </if>
      <if test="creatorId != null" >
        creator_id,
      </if>
      <if test="handlerId != null" >
        handler_id,
      </if>
      <if test="approveStep != null" >
        approve_step,
      </if>
      <if test="approveSugg != null" >
        approve_sugg,
      </if>
      <if test="createdAt != null" >
        created_at,
      </if>
      <if test="updatedAt != null" >
        updated_at,
      </if>
      <if test="status != null" >
        status,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="checkBillNo != null" >
        #{checkBillNo,jdbcType=VARCHAR},
      </if>
      <if test="companyId != null" >
        #{companyId,jdbcType=INTEGER},
      </if>
      <if test="companyName != null" >
        #{companyName,jdbcType=VARCHAR},
      </if>
      <if test="storeHouseId != null" >
        #{storeHouseId,jdbcType=INTEGER},
      </if>
      <if test="storeHouseName != null" >
        #{storeHouseName,jdbcType=VARCHAR},
      </if>
      <if test="matTypeId != null" >
        #{matTypeId,jdbcType=BIGINT},
      </if>
      <if test="matTypeName != null" >
        #{matTypeName,jdbcType=VARCHAR},
      </if>
      <if test="checkBillType != null" >
        #{checkBillType,jdbcType=CHAR},
      </if>
      <if test="baseCheckBillId != null" >
        #{baseCheckBillId,jdbcType=INTEGER},
      </if>
      <if test="checkYear != null" >
        #{checkYear,jdbcType=INTEGER},
      </if>
      <if test="voucherNoFrom != null" >
        #{voucherNoFrom,jdbcType=VARCHAR},
      </if>
      <if test="voucherIdFrom != null" >
        #{voucherIdFrom,jdbcType=BIGINT},
      </if>
      <if test="voucherNoTo != null" >
        #{voucherNoTo,jdbcType=VARCHAR},
      </if>
      <if test="voucherIdTo != null" >
        #{voucherIdTo,jdbcType=BIGINT},
      </if>
      <if test="liquidateFlag != null" >
        #{liquidateFlag,jdbcType=CHAR},
      </if>
      <if test="operatorId != null" >
        #{operatorId,jdbcType=BIGINT},
      </if>
      <if test="creatorId != null" >
        #{creatorId,jdbcType=BIGINT},
      </if>
      <if test="handlerId != null" >
        #{handlerId,jdbcType=BIGINT},
      </if>
      <if test="approveStep != null" >
        #{approveStep,jdbcType=VARCHAR},
      </if>
      <if test="approveSugg != null" >
        #{approveSugg,jdbcType=VARCHAR},
      </if>
      <if test="createdAt != null" >
        #{createdAt,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedAt != null" >
        #{updatedAt,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        #{status,jdbcType=TINYINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.mt.iv.common.model.IvStoreCheckBill" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 28 13:56:09 CST 2017.
    -->
    update iv_store_check_bill
    <set >
      <if test="checkBillNo != null" >
        check_bill_no = #{checkBillNo,jdbcType=VARCHAR},
      </if>
      <if test="companyId != null" >
        company_id = #{companyId,jdbcType=INTEGER},
      </if>
      <if test="companyName != null" >
        company_name = #{companyName,jdbcType=VARCHAR},
      </if>
      <if test="storeHouseId != null" >
        store_house_id = #{storeHouseId,jdbcType=INTEGER},
      </if>
      <if test="storeHouseName != null" >
        store_house_name = #{storeHouseName,jdbcType=VARCHAR},
      </if>
      <if test="matTypeId != null" >
        mat_type_id = #{matTypeId,jdbcType=BIGINT},
      </if>
      <if test="matTypeName != null" >
        mat_type_name = #{matTypeName,jdbcType=VARCHAR},
      </if>
      <if test="checkBillType != null" >
        check_bill_type = #{checkBillType,jdbcType=CHAR},
      </if>
      <if test="baseCheckBillId != null" >
        base_check_bill_id = #{baseCheckBillId,jdbcType=INTEGER},
      </if>
      <if test="checkYear != null" >
        check_year = #{checkYear,jdbcType=INTEGER},
      </if>
      <if test="voucherNoFrom != null" >
        voucher_no_from = #{voucherNoFrom,jdbcType=VARCHAR},
      </if>
      <if test="voucherIdFrom != null" >
        voucher_id_from = #{voucherIdFrom,jdbcType=BIGINT},
      </if>
      <if test="voucherNoTo != null" >
        voucher_no_to = #{voucherNoTo,jdbcType=VARCHAR},
      </if>
      <if test="voucherIdTo != null" >
        voucher_id_to = #{voucherIdTo,jdbcType=BIGINT},
      </if>
      <if test="liquidateFlag != null" >
        liquidate_flag = #{liquidateFlag,jdbcType=CHAR},
      </if>
      <if test="operatorId != null" >
        operator_id = #{operatorId,jdbcType=BIGINT},
      </if>
      <if test="creatorId != null" >
        creator_id = #{creatorId,jdbcType=BIGINT},
      </if>
      <if test="handlerId != null" >
        handler_id = #{handlerId,jdbcType=BIGINT},
      </if>
      <if test="approveStep != null" >
        approve_step = #{approveStep,jdbcType=VARCHAR},
      </if>
      <if test="approveSugg != null" >
        approve_sugg = #{approveSugg,jdbcType=VARCHAR},
      </if>
      <if test="createdAt != null" >
        created_at = #{createdAt,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedAt != null" >
        updated_at = #{updatedAt,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=TINYINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.mt.iv.common.model.IvStoreCheckBill" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 28 13:56:09 CST 2017.
    -->
    update iv_store_check_bill
    set check_bill_no = #{checkBillNo,jdbcType=VARCHAR},
      company_id = #{companyId,jdbcType=INTEGER},
      company_name = #{companyName,jdbcType=VARCHAR},
      store_house_id = #{storeHouseId,jdbcType=INTEGER},
      store_house_name = #{storeHouseName,jdbcType=VARCHAR},
      mat_type_id = #{matTypeId,jdbcType=BIGINT},
      mat_type_name = #{matTypeName,jdbcType=VARCHAR},
      check_bill_type = #{checkBillType,jdbcType=CHAR},
      base_check_bill_id = #{baseCheckBillId,jdbcType=INTEGER},
      check_year = #{checkYear,jdbcType=INTEGER},
      voucher_no_from = #{voucherNoFrom,jdbcType=VARCHAR},
      voucher_id_from = #{voucherIdFrom,jdbcType=BIGINT},
      voucher_no_to = #{voucherNoTo,jdbcType=VARCHAR},
      voucher_id_to = #{voucherIdTo,jdbcType=BIGINT},
      liquidate_flag = #{liquidateFlag,jdbcType=CHAR},
      operator_id = #{operatorId,jdbcType=BIGINT},
      creator_id = #{creatorId,jdbcType=BIGINT},
      handler_id = #{handlerId,jdbcType=BIGINT},
      approve_step = #{approveStep,jdbcType=VARCHAR},
      approve_sugg = #{approveSugg,jdbcType=VARCHAR},
      created_at = #{createdAt,jdbcType=TIMESTAMP},
      updated_at = #{updatedAt,jdbcType=TIMESTAMP},
      status = #{status,jdbcType=TINYINT}
    where id = #{id,jdbcType=BIGINT}
  </update>

  <!-- wendy添加-->

  <!--新增盘点单主表-->
  <insert id="addStoreCheckBill" parameterType="Map" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
    <selectKey resultType="int" order="AFTER" keyProperty="id">
      SELECT LAST_INSERT_ID() as id
    </selectKey>
      insert into iv_store_check_bill
      <trim prefix="(" suffix=")" suffixOverrides="," >
        <if test="check_bill_no != null  and check_bill_no !=''" >
          check_bill_no,
        </if>
        <if test="company_id != null  and company_id !=''" >
          company_id,
        </if>
        <if test="company_name != null and company_name !=''" >
          company_name,
        </if>
        <if test="store_house_id != null  and  store_house_id !=''" >
          store_house_id,
        </if>
        <if test="store_house_name != null and  store_house_name !=''" >
          store_house_name,
        </if>
        <if test="mat_type_id != null and mat_type_id !=''" >
          mat_type_id,
        </if>
        <if test="mat_type_name != null and mat_type_name !=''" >
          mat_type_name,
        </if>
        <if test="check_bill_type != null and check_bill_type !=''" >
          check_bill_type,
        </if>
        <if test="base_check_bill_id != null and base_check_bill_id !=''" >
          base_check_bill_id,
        </if>
        <if test="check_year != null and check_year !=''" >
          check_year,
        </if>
        <if test="voucher_no_from != null and voucher_no_from !=''" >
          voucher_no_from,
        </if>
        <if test="voucher_id_from != null and  voucher_id_from !=''" >
          voucher_id_from,
        </if>
        <if test="voucher_no_to != null and voucher_no_to !=''" >
          voucher_no_to,
        </if>
        <if test="voucher_id_to != null and voucher_id_to !=''" >
          voucher_id_to,
        </if>
        <if test="liquidate_flag != null and liquidate_flag !=''" >
          liquidate_flag,
        </if>
        <if test="operator_id != null and operator_id!=''" >
          operator_id,
        </if>
        <if test="operator_name != null and operator_name!=''" >
          operator_name,
        </if>
        <if test="creator_id != null and creator_id !=''" >
          creator_id,
        </if>

        <if test="handler_id != null and handler_id !=''" >
          handler_id,
        </if>
        <if test="approve_step != null and approve_step !=''" >
          approve_step,
        </if>
        <if test="approve_sugg != null and approve_sugg !=''" >
          approve_sugg,
        </if>
        <if test="created_at != null and  created_at !=''" >
          created_at,
        </if>
        <if test="updated_at != null and  updated_at !=''" >
          updated_at,
        </if>
        <if test="status != null and status !=''" >
          status,
        </if>
      </trim>
      <trim prefix="values (" suffix=")" suffixOverrides="," >
        <if test="check_bill_no != null  and check_bill_no !=''" >
          #{check_bill_no,jdbcType=VARCHAR},
        </if>
        <if test="company_id != null and company_id !='' " >
          #{company_id,jdbcType=INTEGER},
        </if>
        <if test="company_name != null and company_name !=''" >
          #{company_name,jdbcType=VARCHAR},
        </if>
        <if test="store_house_id != null  and  store_house_id !=''" >
          #{store_house_id,jdbcType=INTEGER},
        </if>
        <if test="store_house_name != null and  store_house_name !=''" >
          #{store_house_name,jdbcType=VARCHAR},
        </if>
        <if test="mat_type_id != null and mat_type_id !=''" >
          #{mat_type_id,jdbcType=BIGINT},
        </if>
        <if test="mat_type_name != null and mat_type_name !=''" >
          #{mat_type_name,jdbcType=VARCHAR},
        </if>
        <if test="check_bill_type != null and check_bill_type !=''" >
          #{check_bill_type,jdbcType=CHAR},
        </if>
        <if test="base_check_bill_id != null and base_check_bill_id !=''" >
          #{base_check_bill_id,jdbcType=INTEGER},
        </if>
        <if test="check_year != null and check_year !=''" >
          #{check_year,jdbcType=INTEGER},
        </if>
        <if test="voucher_no_from != null and voucher_no_from !=''" >
          #{voucher_no_from,jdbcType=VARCHAR},
        </if>
        <if test="voucher_id_from != null and  voucher_id_from !=''" >
          #{voucher_id_from,jdbcType=BIGINT},
        </if>
        <if test="voucher_no_to != null and voucher_no_to !=''" >
          #{voucher_no_to,jdbcType=VARCHAR},
        </if>
        <if test="voucher_id_to != null and voucher_id_to !=''" >
          #{voucher_id_to,jdbcType=BIGINT},
        </if>
        <if test="liquidate_flag != null and liquidate_flag !=''" >
          #{liquidate_flag,jdbcType=CHAR},
        </if>
        <if test="operator_id != null and operator_id!=''" >
          #{operator_id,jdbcType=BIGINT},
        </if>
        <if test="operator_name != null and operator_name!=''" >
          #{operator_name,jdbcType=VARCHAR},
        </if>
        <if test="creator_id != null and creator_id !=''" >
          #{creator_id,jdbcType=BIGINT},
        </if>
        <if test="handler_id != null and handler_id !=''" >
          #{handler_id,jdbcType=BIGINT},
        </if>
        <if test="approve_step != null and approve_step !=''" >
          #{approve_step,jdbcType=VARCHAR},
        </if>
        <if test="approve_sugg != null and approve_sugg !=''" >
          #{approve_sugg,jdbcType=VARCHAR},
        </if>
        <if test="created_at != null and  created_at !=''" >
          #{created_at,jdbcType=TIMESTAMP},
        </if>
        <if test="updated_at != null and  updated_at !=''" >
          #{updated_at,jdbcType=TIMESTAMP},
        </if>
        <if test="status != null and status !=''" >
          #{status,jdbcType=TINYINT},
        </if>
      </trim>
    </insert>


  <select  id="selectStoreCheckBillById"  parameterType="java.lang.Long"  resultType="Map">
      select  id as check_bill_id,check_bill_no
      from  iv_store_check_bill
      where id=#{id} and status=1
  </select>

  <update  id="updateStoreCheckBill"  parameterType="map">
    update iv_store_check_bill
    <set >
      <if test="check_bill_no != null  and check_bill_no !=''" >
        check_bill_no = #{check_bill_no,jdbcType=VARCHAR},
      </if>
      <if test="company_id != null  and company_id !=''" >
        company_id = #{company_id,jdbcType=INTEGER},
      </if>
      <if test="company_name != null and company_name !=''" >
        company_name = #{company_name,jdbcType=VARCHAR},
      </if>
      <if test="store_house_id != null  and  store_house_id !=''" >
        store_house_id = #{store_house_id,jdbcType=INTEGER},
      </if>
      <if test="store_house_name != null and  store_house_name !=''" >
        store_house_name = #{store_house_name,jdbcType=VARCHAR},
      </if>
      <if test="mat_type_id != null and mat_type_id !=''" >
        mat_type_id = #{mat_type_id,jdbcType=BIGINT},
      </if>
      <if test="mat_type_name != null and mat_type_name !=''" >
        mat_type_name = #{mat_type_name,jdbcType=VARCHAR},
      </if>
      <if test="check_bill_type != null and check_bill_type !=''" >
        check_bill_type = #{check_bill_type,jdbcType=CHAR},
      </if>
      <if test="base_check_bill_id != null and base_check_bill_id !=''" >
        base_check_bill_id = #{base_check_bill_id,jdbcType=INTEGER},
      </if>
      <if test="check_year != null and check_year !=''" >
        check_year = #{check_year,jdbcType=INTEGER},
      </if>
      <if test="voucher_no_from != null and voucher_no_from !=''" >
        voucher_no_from = #{voucher_no_from,jdbcType=VARCHAR},
      </if>
      <if test="voucher_id_from != null and  voucher_id_from !=''" >
        voucher_id_from = #{voucher_id_from,jdbcType=BIGINT},
      </if>
      <if test="voucher_no_to != null and voucher_no_to !=''" >
        voucher_no_to = #{voucher_no_to,jdbcType=VARCHAR},
      </if>
      <if test="voucher_id_to != null and voucher_id_to !=''" >
        voucher_id_to = #{voucher_id_to,jdbcType=BIGINT},
      </if>
      <if test="liquidate_flag != null and liquidate_flag !=''" >
        liquidate_flag = #{liquidate_flag,jdbcType=CHAR},
      </if>
      <if test="operator_id != null and operator_id!=''" >
        operator_id = #{operator_id,jdbcType=BIGINT},
      </if>
      <if test="creator_id != null and creator_id !=''" >
        creator_id = #{creator_id,jdbcType=BIGINT},
      </if>
      <if test="handler_id != null and handler_id !=''" >
        handler_id = #{handler_id,jdbcType=BIGINT},
      </if>
      <if test="approve_step != null and approve_step !=''" >
        approve_step = #{approve_step,jdbcType=VARCHAR},
      </if>
      <if test="approve_sugg != null and approve_sugg !=''" >
        approve_sugg = #{approve_sugg,jdbcType=VARCHAR},
      </if>
      <if test="created_at != null and  created_at !=''" >
        created_at = #{created_at,jdbcType=TIMESTAMP},
      </if>
      <if test="updated_at != null and  updated_at !=''" >
        updated_at = #{updated_at,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=TINYINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>

  <select  id="selectStoreCheckMatTypeList"  resultType="map"  parameterType="map">
     SELECT mat_type_id,
         mat_type_name
  FROM   iv_store_check_bill_mat_type
  WHERE  check_bill_id = #{check_bill_id}
  </select>

  <!--查询所有盘点物料详情-->
  <select id="selectStoreCheckAllDetail"   resultType="map">
    SELECT check_bill_price, check_bill_qty, check_real_price, check_real_qty, check_profit_loss_qty
    , check_profit_loss_price, mat_id, store_room_id, mat_no, mat_desc
    , mat_type_id, mat_type_name, mat_model
    FROM iv_store_check_bill_sub
    WHERE check_bill_id = #{check_bill_id}
  <if test="mat_id!=null  and mat_id!=''">
    And  mat_id=#{mat_id}
  </if>
  </select>

  <!--查看仓库进行盘点（盘盈盘亏）-->
  <select id="selectHouseStoreCheck"   resultType="map">
      SELECT *
  FROM   iv_store_check_bill
  WHERE  id = #{id}
  </select>

  <!--查询盘点单待盘已盘物料-->
  <select id="selectStoreCheckBillDetail" parameterType="map"  resultType="map">
    SELECT il.id AS check_bill_id,il.check_bill_no,ib.check_bill_price,ib.check_bill_qty
    ,ib.id AS check_detail_id,ib.check_differ_ratio,ib.check_profit_loss_price,ib.check_profit_loss_qty
    ,ib.check_profit_loss_reason,ib.check_real_price,ib.check_real_qty,ib.liquidate_flag,ib.mat_desc
    ,ib.mat_id,ib.mat_model,ib.mat_no,ib.mat_type_id,ib.mat_type_name,ib.store_room_id,ib.store_room_name
    ,il.store_house_id,il.store_house_name,ib.unit
    FROM   iv_store_check_bill il
    INNER JOIN iv_store_check_bill_sub ib
    ON il.id = ib.check_bill_id
    <where>
      <if test="mat_type_ids != null and mat_type_ids!= ''">
        And ib.mat_type_id=#{mat_type_ids}
      </if>
      <if test="query.check_bill_id != null and query.check_bill_id!= ''">
        And il.id=#{query.check_bill_id}
      </if>
      <if test="query.liquidate_flag != null and query.liquidate_flag!= ''">
        And il.liquidate_flag=#{query.liquidate_flag}
      </if>
      <if test="query.mat_desc != null and query.mat_desc!= ''">
        And ib.mat_desc like CONCAT('%','${query.mat_desc}','%' )
      </if>
      <if test="query.mat_no != null and query.mat_no!= ''">
        And ib.mat_no=#{query.mat_no}
      </if>
      And  il.status = 1  limit #{page},#{page_size}
    </where>
  </select>

  <!--查询盘点单待盘已盘物料总条数-->
  <select id="storeChecktotalCount" parameterType="Map"  resultType="java.lang.Integer">
    SELECT Count(*)
    FROM   iv_store_check_bill il
    INNER JOIN iv_store_check_bill_sub ib
    ON il.id = ib.check_bill_id
    <where>
      <if test="mat_type_ids != null and mat_type_ids!= ''">
        And ib.mat_type_id=#{mat_type_ids}
      </if>
      <if test="query.check_bill_id != null and query.check_bill_id!= ''">
        And il.id=#{query.check_bill_id}
      </if>
      <if test="query.liquidate_flag != null and query.liquidate_flag!= ''">
        And ib.liquidate_flag=#{query.liquidate_flag}
      </if>
      <if test="query.mat_desc != null and query.mat_desc!= ''">
        And ib.mat_desc like CONCAT('%','${query.mat_desc}','%' )
      </if>
      <if test="query.mat_no != null and query.mat_no!= ''">
        And ib.mat_no=#{query.mat_no}
      </if>
      And  il.status = 1
    </where>
  </select>

  <!--查询盘点单列表-->
  <select id="selectStoreCheckBillList"  resultType="Map"  parameterType="Map">
    select approve_step,check_bill_no,id as check_bill_id,store_house_id,store_house_name,operator_id,operator_name,liquidate_flag
    from iv_store_check_bill
    <where>
      <if test="approve_step != null and approve_step.size >0">
        approve_step in
        <foreach collection="approve_step" item="list"  open="(" separator="," close=")">
          #{list}
        </foreach>
      </if>
      <if  test="liquidate_flag!=null and liquidate_flag.size>0">
         and liquidate_flag in
        <foreach  collection="liquidate_flag" item="list" open="(" separator="," close=")">
          #{list}
        </foreach>
      </if>
      <if test="company_id != null and company_id != ''">
        and company_id = #{company_id} and  status = 1
      </if>
      and  status = 1    limit #{page},#{page_size}
    </where>
  </select>

  <!--查询总条数-->
  <select id="totalCount" parameterType="Map" resultType="java.lang.Integer">
    SELECT
    count(id)
    FROM iv_store_check_bill
    <where>
      <if test="approve_step != null and approve_step.size >0">
        approve_step in
        <foreach collection="approve_step" item="list"  open="(" separator="," close=")">
          #{list}
        </foreach>
      </if>
      <if  test="liquidate_flag!=null and liquidate_flag.size>0">
        and liquidate_flag in
        <foreach  collection="liquidate_flag" item="list" open="(" separator="," close=")">
          #{list}
        </foreach>
      </if>
      <if test="company_id != null and company_id != ''">
        and company_id = #{company_id} and  status = 1
    </if>
    </where>
  </select>
</mapper>