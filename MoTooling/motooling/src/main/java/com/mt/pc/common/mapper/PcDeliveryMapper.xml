<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mt.pc.common.dao.PcDeliveryMapper" >
  <resultMap id="BaseResultMap" type="com.mt.pc.common.model.PcDelivery" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="delivery_no" property="deliveryNo" jdbcType="VARCHAR" />
    <result column="purch_id" property="purchId" jdbcType="BIGINT" />
    <result column="purch_no" property="purchNo" jdbcType="VARCHAR" />
    <result column="company_id" property="companyId" jdbcType="INTEGER" />
    <result column="company_name" property="companyName" jdbcType="VARCHAR" />
    <result column="cst_company_id" property="cstCompanyId" jdbcType="INTEGER" />
    <result column="cst_name" property="cstName" jdbcType="VARCHAR" />
    <result column="delivery_man" property="deliveryMan" jdbcType="BIGINT" />
    <result column="delivery_man_name" property="deliveryManName" jdbcType="VARCHAR" />
    <result column="delivery_man_phone" property="deliveryManPhone" jdbcType="VARCHAR" />
    <result column="delivery_man_email" property="deliveryManEmail" jdbcType="VARCHAR" />
    <result column="total_qty" property="totalQty" jdbcType="DECIMAL" />
    <result column="total_price" property="totalPrice" jdbcType="DECIMAL" />
    <result column="creator_id" property="creatorId" jdbcType="BIGINT" />
    <result column="handler_id" property="handlerId" jdbcType="BIGINT" />
    <result column="created_at" property="createdAt" jdbcType="TIMESTAMP" />
    <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP" />
    <result column="status" property="status" jdbcType="TINYINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, delivery_no, purch_id, purch_no, company_id, company_name, cst_company_id, cst_name, 
    delivery_man, delivery_man_name, delivery_man_phone, delivery_man_email, total_qty, 
    total_price, creator_id, handler_id, created_at, updated_at, status
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from pc_delivery
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    delete from pc_delivery
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.mt.pc.common.model.PcDelivery" >
    insert into pc_delivery (id, delivery_no, purch_id, 
      purch_no, company_id, company_name, 
      cst_company_id, cst_name, delivery_man, 
      delivery_man_name, delivery_man_phone, delivery_man_email, 
      total_qty, total_price, creator_id, 
      handler_id, created_at, updated_at, 
      status)
    values (#{id,jdbcType=BIGINT}, #{deliveryNo,jdbcType=VARCHAR}, #{purchId,jdbcType=BIGINT}, 
      #{purchNo,jdbcType=VARCHAR}, #{companyId,jdbcType=INTEGER}, #{companyName,jdbcType=VARCHAR}, 
      #{cstCompanyId,jdbcType=INTEGER}, #{cstName,jdbcType=VARCHAR}, #{deliveryMan,jdbcType=BIGINT}, 
      #{deliveryManName,jdbcType=VARCHAR}, #{deliveryManPhone,jdbcType=VARCHAR}, #{deliveryManEmail,jdbcType=VARCHAR}, 
      #{totalQty,jdbcType=DECIMAL}, #{totalPrice,jdbcType=DECIMAL}, #{creatorId,jdbcType=BIGINT}, 
      #{handlerId,jdbcType=BIGINT}, #{createdAt,jdbcType=TIMESTAMP}, #{updatedAt,jdbcType=TIMESTAMP}, 
      #{status,jdbcType=TINYINT})
  </insert>
  <insert id="insertSelective" parameterType="com.mt.pc.common.model.PcDelivery" >
    insert into pc_delivery
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="deliveryNo != null" >
        delivery_no,
      </if>
      <if test="purchId != null" >
        purch_id,
      </if>
      <if test="purchNo != null" >
        purch_no,
      </if>
      <if test="companyId != null" >
        company_id,
      </if>
      <if test="companyName != null" >
        company_name,
      </if>
      <if test="cstCompanyId != null" >
        cst_company_id,
      </if>
      <if test="cstName != null" >
        cst_name,
      </if>
      <if test="deliveryMan != null" >
        delivery_man,
      </if>
      <if test="deliveryManName != null" >
        delivery_man_name,
      </if>
      <if test="deliveryManPhone != null" >
        delivery_man_phone,
      </if>
      <if test="deliveryManEmail != null" >
        delivery_man_email,
      </if>
      <if test="totalQty != null" >
        total_qty,
      </if>
      <if test="totalPrice != null" >
        total_price,
      </if>
      <if test="creatorId != null" >
        creator_id,
      </if>
      <if test="handlerId != null" >
        handler_id,
      </if>
      <if test="createdAt != null" >
        created_at,
      </if>
      <if test="updatedAt != null" >
        updated_at,
      </if>
      <if test="status != null" >
        status,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="deliveryNo != null" >
        #{deliveryNo,jdbcType=VARCHAR},
      </if>
      <if test="purchId != null" >
        #{purchId,jdbcType=BIGINT},
      </if>
      <if test="purchNo != null" >
        #{purchNo,jdbcType=VARCHAR},
      </if>
      <if test="companyId != null" >
        #{companyId,jdbcType=INTEGER},
      </if>
      <if test="companyName != null" >
        #{companyName,jdbcType=VARCHAR},
      </if>
      <if test="cstCompanyId != null" >
        #{cstCompanyId,jdbcType=INTEGER},
      </if>
      <if test="cstName != null" >
        #{cstName,jdbcType=VARCHAR},
      </if>
      <if test="deliveryMan != null" >
        #{deliveryMan,jdbcType=BIGINT},
      </if>
      <if test="deliveryManName != null" >
        #{deliveryManName,jdbcType=VARCHAR},
      </if>
      <if test="deliveryManPhone != null" >
        #{deliveryManPhone,jdbcType=VARCHAR},
      </if>
      <if test="deliveryManEmail != null" >
        #{deliveryManEmail,jdbcType=VARCHAR},
      </if>
      <if test="totalQty != null" >
        #{totalQty,jdbcType=DECIMAL},
      </if>
      <if test="totalPrice != null" >
        #{totalPrice,jdbcType=DECIMAL},
      </if>
      <if test="creatorId != null" >
        #{creatorId,jdbcType=BIGINT},
      </if>
      <if test="handlerId != null" >
        #{handlerId,jdbcType=BIGINT},
      </if>
      <if test="createdAt != null" >
        #{createdAt,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedAt != null" >
        #{updatedAt,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        #{status,jdbcType=TINYINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.mt.pc.common.model.PcDelivery" >
    update pc_delivery
    <set >
      <if test="deliveryNo != null" >
        delivery_no = #{deliveryNo,jdbcType=VARCHAR},
      </if>
      <if test="purchId != null" >
        purch_id = #{purchId,jdbcType=BIGINT},
      </if>
      <if test="purchNo != null" >
        purch_no = #{purchNo,jdbcType=VARCHAR},
      </if>
      <if test="companyId != null" >
        company_id = #{companyId,jdbcType=INTEGER},
      </if>
      <if test="companyName != null" >
        company_name = #{companyName,jdbcType=VARCHAR},
      </if>
      <if test="cstCompanyId != null" >
        cst_company_id = #{cstCompanyId,jdbcType=INTEGER},
      </if>
      <if test="cstName != null" >
        cst_name = #{cstName,jdbcType=VARCHAR},
      </if>
      <if test="deliveryMan != null" >
        delivery_man = #{deliveryMan,jdbcType=BIGINT},
      </if>
      <if test="deliveryManName != null" >
        delivery_man_name = #{deliveryManName,jdbcType=VARCHAR},
      </if>
      <if test="deliveryManPhone != null" >
        delivery_man_phone = #{deliveryManPhone,jdbcType=VARCHAR},
      </if>
      <if test="deliveryManEmail != null" >
        delivery_man_email = #{deliveryManEmail,jdbcType=VARCHAR},
      </if>
      <if test="totalQty != null" >
        total_qty = #{totalQty,jdbcType=DECIMAL},
      </if>
      <if test="totalPrice != null" >
        total_price = #{totalPrice,jdbcType=DECIMAL},
      </if>
      <if test="creatorId != null" >
        creator_id = #{creatorId,jdbcType=BIGINT},
      </if>
      <if test="handlerId != null" >
        handler_id = #{handlerId,jdbcType=BIGINT},
      </if>
      <if test="createdAt != null" >
        created_at = #{createdAt,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedAt != null" >
        updated_at = #{updatedAt,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=TINYINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.mt.pc.common.model.PcDelivery" >
    update pc_delivery
    set delivery_no = #{deliveryNo,jdbcType=VARCHAR},
      purch_id = #{purchId,jdbcType=BIGINT},
      purch_no = #{purchNo,jdbcType=VARCHAR},
      company_id = #{companyId,jdbcType=INTEGER},
      company_name = #{companyName,jdbcType=VARCHAR},
      cst_company_id = #{cstCompanyId,jdbcType=INTEGER},
      cst_name = #{cstName,jdbcType=VARCHAR},
      delivery_man = #{deliveryMan,jdbcType=BIGINT},
      delivery_man_name = #{deliveryManName,jdbcType=VARCHAR},
      delivery_man_phone = #{deliveryManPhone,jdbcType=VARCHAR},
      delivery_man_email = #{deliveryManEmail,jdbcType=VARCHAR},
      total_qty = #{totalQty,jdbcType=DECIMAL},
      total_price = #{totalPrice,jdbcType=DECIMAL},
      creator_id = #{creatorId,jdbcType=BIGINT},
      handler_id = #{handlerId,jdbcType=BIGINT},
      created_at = #{createdAt,jdbcType=TIMESTAMP},
      updated_at = #{updatedAt,jdbcType=TIMESTAMP},
      status = #{status,jdbcType=TINYINT}
    where id = #{id,jdbcType=BIGINT}
  </update>

  <!--Alnwick 添加-->
  <insert id="addDelivery" parameterType="map" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
    <selectKey resultType="int" order="AFTER" keyProperty="id">
         SELECT LAST_INSERT_ID() as id
    </selectKey>
        INSERT  INTO pc_delivery
      <trim prefix="(" suffix=")" suffixOverrides="," >
        <if test="delivery_no != null and delivery_no != ''" >
          delivery_no,
        </if>
        <if test="purch_id != null and purch_id != ''" >
          purch_id,
        </if>
        <if test="purch_no != null and purch_no != ''" >
          purch_no,
        </if>
        <if test="company_id != null and company_id != ''" >
          company_id,
        </if>
        <if test="company_name != null and company_name != ''" >
          company_name,
        </if>
        <if test="cst_company_id != null and cst_company_id != ''" >
          cst_company_id,
        </if>
        <if test="cst_name != null and cst_name != ''" >
          cst_name,
        </if>
        <if test="delivery_man != null and delivery_man != ''" >
          delivery_man,
        </if>
        <if test="delivery_man_name != null and delivery_man_name != ''" >
          delivery_man_name,
        </if>
        <if test="delivery_man_phone != null and delivery_man_phone != ''" >
          delivery_man_phone,
        </if>
        <if test="delivery_man_email != null and delivery_man_email != ''" >
          delivery_man_email,
        </if>
        <if test="total_qty != null and total_qty != ''" >
          total_qty,
        </if>
        <if test="total_price != null and total_price != ''" >
          total_price,
        </if>
        <if test="creator_id != null and creator_id != ''" >
          creator_id,
        </if>
        <if test="handler_id != null and handler_id != ''" >
          handler_id,
        </if>
        <if test="created_at != null and created_at != ''" >
          created_at,
        </if>
        <if test="status != null and status != ''" >
          status,
        </if>
      </trim>
      <trim prefix="values (" suffix=")" suffixOverrides="," >
        <if test="deliveryNo != null" >
          #{deliveryNo,jdbcType=VARCHAR},
        </if>
        <if test="purchId != null" >
          #{purchId,jdbcType=BIGINT},
        </if>
        <if test="purchNo != null" >
          #{purchNo,jdbcType=VARCHAR},
        </if>
        <if test="companyId != null" >
          #{companyId,jdbcType=INTEGER},
        </if>
        <if test="companyName != null" >
          #{companyName,jdbcType=VARCHAR},
        </if>
        <if test="cstCompanyId != null" >
          #{cstCompanyId,jdbcType=INTEGER},
        </if>
        <if test="cstName != null" >
          #{cstName,jdbcType=VARCHAR},
        </if>
        <if test="deliveryMan != null" >
          #{deliveryMan,jdbcType=BIGINT},
        </if>
        <if test="deliveryManName != null" >
          #{deliveryManName,jdbcType=VARCHAR},
        </if>
        <if test="deliveryManPhone != null" >
          #{deliveryManPhone,jdbcType=VARCHAR},
        </if>
        <if test="deliveryManEmail != null" >
          #{deliveryManEmail,jdbcType=VARCHAR},
        </if>
        <if test="totalQty != null" >
          #{totalQty,jdbcType=DECIMAL},
        </if>
        <if test="totalPrice != null" >
          #{totalPrice,jdbcType=DECIMAL},
        </if>
        <if test="creatorId != null" >
          #{creatorId,jdbcType=BIGINT},
        </if>
        <if test="handlerId != null" >
          #{handlerId,jdbcType=BIGINT},
        </if>
        <if test="createdAt != null" >
          #{createdAt,jdbcType=TIMESTAMP},
        </if>
        <if test="status != null" >
          #{status,jdbcType=TINYINT},
        </if>
      </trim>
  </insert>

  <select id="getDleveryInfo" resultType="Map" parameterType="java.lang.Long">
        select pd.id as delivery_id,pd.delivery_man,pd.delivery_man_email,pd.delivery_man_name,pd.delivery_man_phone,pd.delivery_no,pd.cst_name,
				ppo.company_id as cst_company_id,DATE_FORMAT(ppo.delivery_date,'%Y-%m-%d') delivery_date ,ppo.invoice_type,ppo.invoice_type_name,ppo.rebate,ppo.tax_ratio,
				ppo.total_price,ppo.total_qty,ppo.coin,ppo.coin_name,ppo.purchman_email as cst_linker_email,ppo.purchman_name as cst_linker_name,
				ppo.purchman_phone as cst_linker_phone,ppo.company_name as cst_name
        from pc_delivery pd , pc_purch_order ppo
        where pd.purch_id = #{purchId} and ppo.id = #{purchId}
  </select>

</mapper>